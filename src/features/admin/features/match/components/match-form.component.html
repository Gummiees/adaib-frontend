<div class="w-full pt-6 pb-4 flex flex-col items-center justify-center gap-6">
  @if(isMatchNotFound()) {
    <app-not-found title="Partido no encontrado" subtitle="Lo sentimos, el partido no se encontró. Inténtelo más tarde." [hideButton]="true"></app-not-found>
  } @else {
    <div class="flex flex-row gap-2 items-center justify-center gap-4">
      <h1 class="text-4xl font-bold">{{ isEditMode() ? 'Editar partido' : 'Crear partido' }}</h1>
      @if(isEditMode()) {
        <a mat-mini-fab aria-label="Eliminar partido" matTooltip="Eliminar partido" matTooltipPosition="right" tabindex="0" [disabled]="isLoading()" (click)="onDelete()" (keyup)="onDelete()" (keypress)="onDelete()">
          <mat-icon>delete</mat-icon>
        </a>
      }
    </div>
    @if(competitionStore.error()) {
      <app-not-found title="Hubo un error" subtitle="Lo sentimos, hubo un error al crear la competición. Inténtelo más tarde." [hideButton]="true"></app-not-found>
    } @else if(isLoading()) {
      <app-full-spinner></app-full-spinner>
    } @else {
      <form [formGroup]="form" class="flex flex-col items-center justify-center gap-2 w-full max-w-2xl" (ngSubmit)="onSubmit()">
        <div class="flex flex-row gap-2 items-center w-full">
          <mat-form-field class="flex-1">
            <mat-label>Fase</mat-label>
            <mat-select formControlName="phaseId">
              @for(phase of phases(); track phase.id) {
                <mat-option [value]="phase.id">{{ phase.name }}</mat-option>
              }
            </mat-select>
            @if(form.get('phaseId')?.errors?.['required']) {
              <mat-error>La fase es requerida</mat-error>
            }
          </mat-form-field>
          @if(!!form.get('phaseId')?.value) {
            <a mat-mini-fab aria-label="Editar fase" matTooltip="Editar fase" matTooltipPosition="right" tabindex="0" [disabled]="isLoading()" (click)="onEditPhase()" (keyup)="onEditPhase()" (keypress)="onEditPhase()">
              <mat-icon>edit</mat-icon>
            </a>
          }
        </div>
        <div class="flex flex-row gap-2 items-center w-full">
          <mat-form-field class="flex-1">
            <mat-label>Grupo</mat-label>
            <mat-select formControlName="groupId">
              @for(group of groups(); track group.id) {
                <mat-option [value]="group.id">{{ group.name }}</mat-option>
              }
            </mat-select>
            @if(form.get('groupId')?.errors?.['required']) {
              <mat-error>El grupo es requerido</mat-error>
            }
          </mat-form-field>
          @if(!!form.get('groupId')?.value) {
            <a mat-mini-fab aria-label="Editar grupo" matTooltip="Editar grupo" matTooltipPosition="right" tabindex="0" [disabled]="isLoading()" (click)="onEditGroup()" (keyup)="onEditGroup()" (keypress)="onEditGroup()">
              <mat-icon>edit</mat-icon>
            </a>
          }
        </div>
        <div class="flex flex-row gap-2 items-center w-full">
          <mat-form-field class="flex-1">
            <mat-label>Jornada</mat-label>
            <mat-select formControlName="roundId">
              @for(round of rounds(); track round.id) {
                <mat-option [value]="round.id">{{ round.name }}</mat-option>
              }
            </mat-select>
            @if(form.get('roundId')?.errors?.['required']) {
              <mat-error>La jornada es requerida</mat-error>
            }
          </mat-form-field>
          @if(!!form.get('roundId')?.value) {
            <a mat-mini-fab aria-label="Editar jornada" matTooltip="Editar jornada" matTooltipPosition="right" tabindex="0" [disabled]="isLoading()" (click)="onEditRound()" (keyup)="onEditRound()" (keypress)="onEditRound()">
              <mat-icon>edit</mat-icon>
            </a>
          }
        </div>
        <div class="flex flex-row gap-2 items-center w-full">
          <mat-form-field class="flex-1">
            <mat-label>Estado</mat-label>
            <mat-select formControlName="status">
              <mat-option value="NotStarted">No iniciado</mat-option>
              <mat-option value="OnGoing">En curso</mat-option>
              <mat-option value="Cancelled">Cancelado</mat-option>
              <mat-option value="Rest">Descanso</mat-option>
              <mat-option value="Finished">Finalizado</mat-option>
              <mat-option value="NoShow">No presentado</mat-option>
            </mat-select>
            @if(form.get('status')?.errors?.['required']) {
              <mat-error>El estado es requerido</mat-error>
            }
          </mat-form-field>
          @if(form.get('status')?.value === 'NoShow') {
            <mat-form-field class="flex-1">
              <mat-label>Equipo no presentado*</mat-label>
              <mat-select formControlName="noShowTeamId">
                @for(team of selectedTeams(); track team.id) {
                  <mat-option [value]="team.id">{{ team.name }}</mat-option>
                }
              </mat-select>
              @if(form.get('noShowTeamId')?.errors?.['noShowTeamRequired']) {
                <mat-error>El equipo no presentado es requerido</mat-error>
              }
            </mat-form-field>
          }
        </div>
        <mat-form-field class="w-full">
          <mat-label>Equipo local</mat-label>
          <mat-select formControlName="homeTeamId">
            @for(team of teams(); track team.id) {
              <mat-option [value]="team.id">{{ team.name }}</mat-option>
            }
          </mat-select>
          @if(form.get('homeTeamId')?.errors?.['noShowTeamRequired']) {
            <mat-error>El equipo local es requerido</mat-error>
          }
        </mat-form-field>
        <mat-form-field class="w-full">
          <mat-label>Equipo visitante*</mat-label>
          <mat-select formControlName="awayTeamId">
            @for(team of teams(); track team.id) {
              <mat-option [value]="team.id">{{ team.name }}</mat-option>
            }
          </mat-select>
          @if(form.get('awayTeamId')?.errors?.['awayTeamRequired']) {
            <mat-error>El equipo visitante es requerido</mat-error>
          }
        </mat-form-field>
        <div class="flex flex-row gap-2 items-center w-full">
          <mat-form-field class="w-full">
            <mat-label>Puntos equipo local*</mat-label>
            <input matInput type="number" formControlName="homeTeamScore" min="0" />
            @if(form.get('homeTeamScore')?.errors?.['scoreRequired']) {
              <mat-error>Los puntos son requeridos</mat-error>
            }
            @if(form.get('homeTeamScore')?.errors?.['min']) {
              <mat-error>Los puntos no pueden ser negativos</mat-error>
            }
          </mat-form-field>
          <mat-form-field class="w-full">
            <mat-label>Puntos equipo visitante*</mat-label>
            <input matInput type="number" formControlName="awayTeamScore" min="0" />
            @if(form.get('awayTeamScore')?.errors?.['scoreRequired']) {
              <mat-error>Los puntos son requeridos</mat-error>
            }
            @if(!!form.get('awayTeamScore')?.errors?.['min']) {
              <mat-error>Los puntos no pueden ser negativos</mat-error>
            }
          </mat-form-field>
        </div>
        <div class="flex flex-row gap-2 items-center w-full">
          <mat-form-field class="w-full">
            <mat-label>Fecha del partido</mat-label>
            <input matInput [matDatepicker]="datepicker" formControlName="date">
            <mat-hint>DD/MM/YYYY</mat-hint>
            <mat-datepicker-toggle matIconSuffix [for]="datepicker"></mat-datepicker-toggle>
            <mat-datepicker #datepicker></mat-datepicker>
          </mat-form-field>
          <mat-form-field class="w-full">
            <mat-label>Hora del partido*</mat-label>
            <input matInput [matTimepicker]="timepicker" formControlName="time">
            <mat-timepicker-toggle matIconSuffix [for]="timepicker"></mat-timepicker-toggle>
            <mat-timepicker interval="15min" #timepicker></mat-timepicker>
            @if(form.get('time')?.errors?.['timeRequired']) {
              <mat-error>La hora es requerida</mat-error>
            }
          </mat-form-field>
        </div>
        <div class="flex flex-row gap-2 items-center pt-2 justify-between w-full">
          @if(isEditMode() && shouldShowCreateButton()) {
            <a matButton="outlined" matTooltip="Crear nuevo partido" tabindex="0" [disabled]="isLoading()" (click)="onCreateNew()" (keyup)="onCreateNew()" (keypress)="onCreateNew()">
              Nuevo partido
            </a>
          }
          <button matButton="filled" type="submit" [disabled]="isMainButtonDisabled()">
            {{ isEditMode() ? 'Guardar' : 'Crear' }}
          </button>
        </div>
      </form>
    }
  }
</div>
