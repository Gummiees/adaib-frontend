<div class="w-full pt-6 pb-4 flex flex-col gap-2">
  <h2 class="text-4xl font-bold text-center">Resultados</h2>
  @if(competition().phases.length > 0) {
    <div class="flex flex-col md:flex-row gap-2 w-full">
      <mat-form-field class="w-full">
        <mat-label>Fase</mat-label>
        <mat-select [value]="phaseFilter()" (selectionChange)="onPhaseFilterChange($event.value)">
          <mat-option value="all">Todas</mat-option>
          @for (phase of availablePhases(); track phase.id) {
            <mat-option [value]="phase">{{ phase.name }}</mat-option>
          }
        </mat-select>
      </mat-form-field>
      @if(availableGroups().length > 0) {
        <mat-form-field class="w-full">
          <mat-label>Grupo</mat-label>
          <mat-select [value]="groupFilter()" (selectionChange)="onGroupFilterChange($event.value)">
            <mat-option value="all">Todos</mat-option>
            @for (group of availableGroups(); track group.id) {
              <mat-option [value]="group">{{ group.name }}</mat-option>
            }
          </mat-select>
        </mat-form-field>
      }
      @if(availableRounds().length > 0) {
        <mat-form-field class="w-full">
          <mat-label>Jornada</mat-label>
          <mat-select [value]="roundFilter()" (selectionChange)="onRoundFilterChange($event.value)">
            <mat-option value="all">Todas</mat-option>
            @for (round of availableRounds(); track round.id) {
              <mat-option [value]="round">{{ round.name }}</mat-option>
            }
          </mat-select>
        </mat-form-field>

        <mat-form-field class="w-full">
          <mat-label>Agrupar</mat-label>
          <mat-select [value]="groupByRound()" (selectionChange)="onGroupByRoundChange($event.value)">
            <mat-option [value]="false">No agrupar</mat-option>
            <mat-option [value]="true">Agrupar por jornadas</mat-option>
          </mat-select>
        </mat-form-field>
      }
    </div>
  }


  @if(groupByRound()) {
    @if(filteredCompetitionByRound().phases.length > 0) {
      @for (phase of filteredCompetitionByRound().phases; track phase.id) {
        @for (round of phase.roundsWithMatches; track round.id) {
          <h3 class="text-xl font-bold text-center py-1">{{ round.name }}</h3>
          @if(round.matches.length > 0) {
            @for (match of round.matches; track match.id) {
              <app-match [match]="match"></app-match>
            }
          }
        }
      }
    }
  } @else if(filteredCompetition().phases.length > 0) {
    @for (phase of filteredCompetition().phases; track phase.id) {
      @if(phase.groups.length > 0) {
        @for (group of phase.groups; track group.id) {
          @if(group.matches.length > 0) {
            @for (match of group.matches; track match.id) {
              <app-match [match]="match"></app-match>
            }
          }
        }
      }
    }
  }

  @if(!hasVisibleMatches()) {
    <app-not-found title="No hay resultados disponibles" subtitle="No hay resultados que coincidan con los filtros seleccionados." [hideButton]="true"></app-not-found>
  }
</div>
